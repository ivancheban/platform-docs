# Начало работы

В данном руководстве мы покажем Вам, как начать работу с платформой:

* Установка клиента CLI;
* Основные понятия; 
* Начало работы на GPU в среде Jupyter Notebooks.

## Установка CLI

Для начала работы с CLI имеются две возможности:

* При помощи [Веб терминала](https://apps.neu.ro/shell?cluster_name=neuro-public)
* Установив Neu.ro CLI на Ваш компьютер и выполнив команду `neuro login`

Первый вариант рекомендуется для изучения платформы. Второй вариант лучше подходит для работы над Вашими проектами.

### Установка в Linux и Mac OS

Neu.ro CLI требует установленный Python 3 \(рекомендуется: 3.7, требуется: &gt;=3.6\). Мы советуем использовать [Anaconda Python 3.7 Distribution](https://www.anaconda.com/distribution/).

```text
pip install -U neuro-cli neuro-extras neuro-flow
neuro login
```

### Установка в Windows

Несмотря на то, что есть несколько вариантов запустить Neu.ro CLI в Windows, мы настоятельно рекомендуем использовать [Anaconda Python 3.7 Distribution](https://www.anaconda.com/distribution/) с настройками по умолчанию.

После установки Anaconda Python 3.7 Distribution выполните следующие команды в Conda Prompt:

```text
conda install -c conda-forge make
conda install -c conda-forge git    
pip install -U neuro-cli neuro-extras neuro-flow
pip install -U certifi
neuro login
```

Чтобы удостовериться, что все команды, встречающиеся в нашей документации, работают корректно, не забывайте запускать `bash` _****_при каждом открытии Conda Prompt.

## Основные понятия

На уровне **Neu.ro Core**, происходит работа с заданиями, рабочим окружением и системой хранения \(дисковым пространством\). Проще говоря, возможно запустить задание \(исполнительный блок\) в заданном рабочем окружении \(Docker контейнер\), с заданными характеристиками \(комбинация ресурсов CPU, GPU и памяти\) и с несколькими подключенными блоками для хранения данных \(блоки или объекты хранения\).

Продемонстрируем это на нескольких примерах.

Запустим на CPU задание, которое выводит “Hello, World!” и останавливается:

```text
neuro run --preset cpu-small --name test ubuntu echo Hello, World!
```

После запуска данной команды в терминале Вы увидите следующее:

```text
√ Job ID: job-7dd12c3c-ae8d-4492-bdb9-99509fda4f8c
√ Name: test
- Status: pending Creating
- Status: pending Scheduling
√ Http URL: https://test--jane-doe.jobs.neuro-compute.org.neu.ro
√ The job will die in a day. See --life-span option documentation for details.
√ Status: succeeded
√ =========== Job is running in terminal mode ===========
√ (If you don't see a command prompt, try pressing enter)
√ (Use Ctrl-P Ctrl-Q key sequence to detach from the job)
Hello, World!
```

Запустим задание на GPU в рабочем окружении по умолчанию \(`neuromation/base`\), которое показывает, доступно ли CUDA в данном рабочем окружении:

```text
neuro run --preset gpu-k80-small --name test neuromation/base python -c "import torch; print(torch.cuda.is_available());"
```

Проверим настройки, которые Вы можете использовать:

```text
neuro config show
```

Создадим каталог `demo` в корне дискового пространства Вашей платформы:

```text
neuro mkdir -p storage:demo
```

Запустим команду, которая монтирует каталог `demo` на диске к `/demo` в контейнере и создает в нем файл:

```text
neuro run --preset cpu-small --name test --volume storage:demo:/demo:rw ubuntu bash -c "echo Hello >> /demo/hello.txt"
```

Убедитесь, что файл находится на диске:

```text
neuro ls storage:demo
```

## Разработка на GPU

Хотя сеанс Jupyter Notebooks можно запустить с помощью одной команды в командной строке или одним щелчком мыши в веб-интерфейсе, мы рекомендуем вести разработку на основе проектов. Чтобы упростить процесс, мы предоставляем шаблон проекта, который является частью **Neu.ro Toolbox** и предоставляет структуру папок и интеграцию с несколькими рекомендуемыми инструментами.

### Создание проекта

Чтобы создать новый проект из шаблона, выполните команду:

```text
neuro project init
```

Данная команда задает несколько вопросов относительно Вашего проекта:

```text
project_name [Name of the project]: Neuro Tutorial
project_slug [neuro-tutorial]:
code_directory [modules]:
```

Вы можете нажать Enter, если согласны с предложенным выбором.

Чтобы перейти к каталогу проекта, введите команду:

```text
cd neuro-tutorial
```

### Структура проекта

Структура папки с проектом будет выглядеть следующем образом:

```text
neuro-tutorial
├── .neuro/             <- neuro and neuro-flow CLI configuration files
├── config/             <- configuration files for various integrations
├── data/               <- training and testing datasets (we do not keep it under source control)
├── notebooks/          <- Jupyter notebooks
├── modules/            <- source code of models
├── results/            <- training artifacts
├── .gitignore          <- default .gitignore for a Python ML project
├── .neuro.toml         <- autogenerated config file
├── HELP.md             <- autogenerated template reference
├── README.md           <- autogenerated informational file
├── Dockerfile          <- description of base image used for your project
├── apt.txt             <- list of system packages to be installed in the training environment
├── requirements.txt    <- list of Python dependencies to be installed in the training environment
└── setup.cfg           <- linter settings (Python code quality checking)
```

Шаблон содержит файл конфигурации `.neuro/live.yaml` для `neuro-flow`, который обеспечивает связь между указанной выше структурой файлов и каталогов, базовым рабочим окружением, которое мы предоставляем и манипуляциями с дисковым пространством и заданиями. Например, с помощью команды `upload` подпапки на Вашем локальном компьютере синхронизируются с подпапками на дисковом пространстве платформы, а подпапки на дисковом пространстве синхронизируются с соответствующими подпапками в контейнерах заданий.

### Настройка рабочей среды и запуск Jupyter

Чтобы настроить рабочее окружение, выполните:

```text
> neuro-flow build myimage
> neuro-flow mkvolumes
```

После выполнения данных команд в базовую среду, которая уже содержит поддержку CUDA и наиболее популярные пакеты ML/AL, такие как Tensorflow и Pytorch, будут установлены системные пакеты из `apt.txt` и pip-зависимости из файла `requirements.txt`.

Для того, чтобы Jupyter Notebooks корректно работали, скрипт `train.py` должен быть доступен на дисковом пространстве платформы. Загрузите папку `code`, содержащую этот файл, на дисковое пространство платформы с помощью такой команды:

```text
> neuro-flow upload code
```

Чтобы запустить Jupyter Notebooks на GPU, выполните команду:

```text
neuro-flow run jupyter
```

Данная команда открывает интерфейс Jupyter Notebooks в вашем браузере по умолчанию.

Теперь, когда Вы пишете программу в Jupyter Notebooks, она сохраняется на дисковом пространстве платформы. Чтобы скачать ее на Ваш компьютер \(например, для связи с системой контроля версий\), введите команду:

```text
neuro-flow download notebooks
```

Не забудьте закончить работу задания, когда оно Вам больше не нужно \(файлы после этого не пропадут\):

```text
neuro-flow kill jupyter
```

Чтобы проверить, сколько часов GPU и CPU у вас осталось, запустите команду:

```text
neuro config show-quota
```

