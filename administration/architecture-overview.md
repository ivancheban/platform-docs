# Обзор архитектуры

Наша платформа - MLOps PaaS, способствующий реализации и поддерживающий полный цикл ML-операций, таких как обработка данных и разработка, обучение и выкладка моделей.

### Высокоуровневая архитектура

Платформа состоит из нескольких логических компонентов:

* **Control Plane**, позволяющая управлять всеми аспектами платформы;
  * **CLI**;
  * **Веб-приложение**;
* **Кластер вычислений**, объект первого класса внутри Control Plane, позволяющий запускать ML-процессы;

### Control Plane

Control Plane - "мозг" платформы. Его основная функциональность включает в себя:

* Управление пользователями и их квотами ресурсов;
* Управление RBAC/ACL;
* Управление Кластерами вычислений и их жизненным циклом;
* Сохранение метаданных заданий;
* Управление циклом жизни заданий;
* Отправление нотификаций пользователям;
* Хостинг Веб-приложения;
* Хостинг Веб-документации;

Control Plane требует:

* Балансировщик нагрузки со внешним IP-адресом;
* Kubernetes для запуска управленческих микросервисов;
  * Правильно настроенный StorageClass, используемый по умолчанию;
  * Traefik как контроллер Ingress;
* PostgreSQL для хранения метаданных заданий, метаданных пользователей и ролей;
* Redis для хранения ACL ролей и образования очередей нотификаций пользователей;

#### Компоненты

**Auth API**

Типический расширяемый API для внедрения и настройки иерархических списков управления доступом \(ACLs\), привязанных к ролям.

**Admin API**

Высокоуровневый семантический API, надстроенный над Auth API, для управления пользователями, кластерами, к которым у них есть доступ, их ролями на этих кластерах, квотами ресурсов, и т.д. 

**Config API**

API для управления жизненными циклами кластеров. Этот API предоставляет кластеры и даёт возможность изменять их конфигурацию, выводить их из эксплуатации, и т.д. Для его внутренней работы используются Argo Workflows и Terraform.

**Jobs API**

API для хранения метаданных заданий, управления их циклами жизни и осуществления работы квот. Этот сервис соединяется с Kubernetes API кластеров.

**Ingress Auth**

Сервис, enforces the optional схему аутентификации единого входа для заданий с открытым HTTP-портом. Он также реализует стратегию прямой аутентификации для контроллера Traefik Ingress.

**Notifications API**

API для отправления нотификаций через Email/Slack о событиях, таких как изменение статуса, исчерпание квоты пользователем, и т.д.

**Apps API**

API для запуска курированного набора приложений из Web UI.  


![](https://docs.google.com/drawings/u/0/d/sQRbH5l4pOqzkQ1_xh5Yf_w/image?w=624&h=448&rev=35&ac=1&parent=1gfaR1TpHsjk2U6aIkxgnMJM66LVs4NHuh2Qox6VgEsw)

**Web UI**

Веб-интерфейс для управления вычислительными нагрузками, запуска приложений, управления секретами, проверки квот пользователей, и т.д.

**Neuro CLI**

Основной инструмент для взаимодействия с Control plane и кластерами вычислений. Позволяет пользователям управлять кластерами и переключаться между ними, управлять вычислительными нагрузками, дисковым пространством и образами контейнера, и т.д.

**Neuro-Flow CLI**

Движок для запуска вычислительных нагрузок, основанный на Neuro CLI.

**Neuro-Extras CLI**

Набор полезных инструментов для Neuro CLI - например, пренос дискового пространства и образов контейнера между кластерами.  


**Веб-документация**

Актуальная пользовательская документация для Web UI и CLI с примерами использования и другой полезной информацией.  


![](https://docs.google.com/drawings/u/0/d/szLRCQnXfehlcufuf93Zq5Q/image?w=624&h=359&rev=281&ac=1&parent=1gfaR1TpHsjk2U6aIkxgnMJM66LVs4NHuh2Qox6VgEsw)

### Кластер вычислений

Стандартный кластер вычислений требует:

* Балансировщик нагрузок со внешним IP-адресом;
* Кластер Kubernetes для запуска управленческих микросервисов и вычислительных нагрузок;
* Реестр контейнеров, управляемый провайдером облачных сервисов или запущенный внутри кластера Kubernetes;
* Сетевое хранилище файлов с высокой пропускной способностью и низкой задержкой, доступное через NFS/SMB;
* Выгодное хранилище объектов для архивных целей;

#### Компоненты

**Storage API**

API для управления содержимым сетевого хранилища файлов.

**Blob Storage API**

API для управления бакетами и объектами в хранилище объектов.

**Registry API**

Сервис, совместимый с Docker Registry API, для управления образами контейнеров.

**Monitoring API**

API для передачи логов в реальном времени и отображения архивных логов, телеметрии вычислительных нагрузок в реальном времени, удалённого запуска команд и переадресации портов.

**Secrets API**

API для управления секретами пользователей.

**Disk API**

API для управления постоянным блочным хранилищем данных.

**Reports**

Сервис для получения архивной телеметрии вычислительных нагрузок с учётом уровня доступа пользователей.  


![](https://docs.google.com/drawings/u/0/d/s47zQl0QXlpD1m4RHtVoDYA/image?w=624&h=448&rev=620&ac=1&parent=1gfaR1TpHsjk2U6aIkxgnMJM66LVs4NHuh2Qox6VgEsw)

