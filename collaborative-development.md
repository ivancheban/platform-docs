# Совместная разработка

Как Вы уже [знаете](getting-started.md#understanding-core-concepts), основными понятиями в Neu.ro являются задания, дисковое пространство и рабочее окружение. Вы можете поделиться заданием, дисковым пространством или образом на платформе со своими коллегами по команде, предоставив им права на чтение, изменение или даже удаление данных сущностей.

Мы рекомендуем хранить код проекта в репозитории Git. В этом случае каждый член команды имеет локальную копию репозитория и может выполнять работы независимо. Чтобы настроить свой проект, выполните следующие действия.

### Создание нового проекта Neu.ro

Сначала необходимо создать новый проект Neu.ro из шаблона. Запустите команду `neuro project init` и ответьте на несколько простых вопросов.

### Сохранение проекта в git-репозитории

Теперь необходимо поместить наш новый проект в репозиторий git. Следуйте инструкциям для Git-хостинга, который Вы выбрали \(например, здесь приведены [инструкции для GitHub](https://help.github.com/en/github/importing-your-projects-to-github/adding-an-existing-project-to-github-using-the-command-line)\).

### Обращение с данными

Существует несколько вариантов для хранения данных Вашего проекта в открытом для других пространстве.

#### Дисковое пространство платформы

Вы можете загрузить данные на дисковое пространство платформы, используя команду `neuro cp` в CLI или FileBrowser в веб-интерфейсе. В этом случае Вам необходимо явно предоставить доступ своим коллегам по команде.

Например, вот как Вы можете загрузить данные в папку `cifar-10` на диске и поделиться ими с Алисой:

```text
neuro cp -r local-folder-with-data storage:cifar-10
neuro share storage:cifar-10 alice manage
```

После этого, чтобы сохранить полный URI ваших данных, необходимо обновить значение `data/remote:` в файле `.neuro/live.yaml` проекта. Это позволит Вашим коллегам по команде использовать эту папку с данными в своих копиях проекта \(здесь `neuro-compute` - имя нашего кластера по умолчанию, а `bob` - Ваше имя пользователя на платформе\):

```text
data:
    remote: storage://neuro-compute/bob/cifar-10
    mount: /project/data
    local: data
```

После этого Ваши данные станут доступны в папке `/data` в локальной файловой системе заданий, над которыми работаете Вы и Ваши коллеги по команде.

#### Области памяти \(Buckets\)

Вы можете использовать AWS или GCP buckets для сохранения Ваших данных за пределами платформы Neu.ro. В этом случае необходимо добавить токен доступа в папку `config` проекта, в соответствии с рекомендациями [AWS](https://docs.neu.ro/toolbox/accessing-object-storage-in-aws) или [GCP](https://docs.neu.ro/toolbox/accessing-object-storage-in-gcp). Обратите внимание, что Git не отслеживает эти токены, поэтому Ваши коллеги по команде также должны поместить свои токены в свои локальные копии проекта.

#### Публичные ресурсы

Ваши данные также могут быть доступны на каком-либо общедоступном ресурсе, который не требует аутентификации. В этом случае Вы можете либо поместить копию данных на дисковое пространство платформы \(см. выше\), либо загружать данные в локальную файловую систему контейнера при каждом запуске \(если размер данных относительно невелик\).

### Настройка проекта и запуск задания

Теперь все Ваши коллеги по команде могут клонировать проект и начать работу над ним через свои локальные копии. Вот некоторые шаги, которые каждый член команды должен выполнить самостоятельно.

* Чтобы настроить рабочую среду, запустите `neuro-flow build myimage` \(это необходимый шаг, который нужно выполнять каждый раз, когда вы обновляете зависимости pip из файла `requirements.txt` или системные зависимости из `apt.txt`\). 
* Чтобы запустить сеанс Jupyter Notebooks, выполните `neuro-flow run jupyter`. Файлы типа Notebook сохраняются в папке `<project>/notebooks` на дисковом пространстве платформы. Чтобы скачать файл Jupyter Notebooks в локальную копию проекта, выполните `neuro-flow download notebooks`.
* Чтобы запустить обучение из исходного кода, сделайте следующие изменения для вашего задания `train` в файле `.neuro/live.yaml` и выполните команду `neuro-flow run train`. Например:

```text
jobs:
    train:
    ...
    bash: |
        python $[[ volumes.code.mount ]]/train.py
```

Вы можете получить больше информации о функциональности проекта Neu.ro в файле `HELP.md` в папке Вашего проекта.

### Открытие доступа к работающему заданию

Вы можете открыть доступ к любым заданиям, которые вы выполняете на платформе. Чтобы получить список выполняющихся заданий, которые доступны для Вас \(т.е. Ваших и тех, к которым Вам предоставлен доступ\), выполните команду `neuro ps`.

Каждое задание имеет два свойства, которые необходимо знать для предоставления доступа: ID и имя. ID является уникальным идентификатором, в то время как имя может повторяться у разных заданий. Чтобы получить ID задания, необходимо посмотреть список заданий \(`neuro ps`\) или проверить статус конкретного задания \(`neuro status my-cool-job`\).

Например, чтобы предоставить доступ к заданию `jupyter-awesome-project` с ID `job-fb835ab1-5285-4360-8ee1-880a8ebf824c` для Алисы \(где `awesome-project` - краткое имя Вашего проекта\), выполните команду:

```text
neuro share job:job-fb835ab1-5285-4360-8ee1-880a8ebf824c alice read
```

Данная команда позволит Алисе получить доступ к заданию через его ID или полный URI, который состоит из имени кластера, имени владельца и имени или ID задания: `job://neuro-compute/bob/jupyter-awesome-project`:

```text
# read the logs
neuro logs job://neuro-compute/bob/jupyter-awesome-project
neuro logs job-fb835ab1-5285-4360-8ee1-880a8ebf824c   

# run the interactive bash session:
neuro exec job://neuro-compute/bob/jupyter-awesome-project bash  
neuro exec job-fb835ab1-5285-4360-8ee1-880a8ebf824c bash   

# open web interface in the default web browser:
neuro browse job://neuro-compute/bob/jupyter-awesome-project 
neuro browse job-fb835ab1-5285-4360-8ee1-880a8ebf824c
```

Кроме того, Алиса получит доступ к этому заданию в своем [Веб-интерфейсе](https://app.neu.ro/) и сможет отслеживать логи или работать прямо там.

Обратите внимание, что если кто-то получит доступ на запись \(`write`\) к Вашему заданию Jupyter Notebook, то он может изменять файлы Jupyter Notebooks на диске Вашей платформы. Поэтому, чтобы обновить эти файлы в репозитории git, следует сначала загрузить их, затем сделать commit и push.

Существует также краткая команда для предоставления доступа для членов Вашей команды ко всем Вашим заданиям \(прошлым, текущим и будущим\):

```text
neuro share job: alice read
```

### Предоставление доступа к образу Docker

Наш проект содержит [базовое рабочее окружение](https://hub.docker.com/r/neuromation/base), которое мы рекомендуем использовать для большинства проектов. Данная среда основана на [deepo](https://github.com/ufoym/deepo). Она содержит последние версии популярных библиотек ML/DL \(включая Tensorflow 2.0 и PyTorch 1.4\). Когда Вы запускаете `neuro-flow build myimage`, в этой среде устанавливаются дополнительные зависимости, которые указаны в файлах `requirements.txt` и `apt.txt`, которые затем сохраняются в Docker-реестре платформы. В этом случае нет необходимости открывать доступ к образу коллегам по команде, так как они в свою очередь могут создать такой же образ из той же кодовой базы.

Однако, в отдельных случаях, Вы можете использовать другой образ Docker в качестве базового. Если этот образ общедоступен, все, что вам нужно сделать, это обновить переменную `images/myimage/ref` в файле `.neuro/live.yaml` проекта:

```text
images:
  myimage:
    ref: ufoym/deepo
```

Если образ не является общедоступным, Вам нужно открыть доступ для Ваших коллег:

```text
# upload to your registry:
neuro image push project-specific-docker-image

# share with your teammates:
neuro share image:project-specific-docker-image alice read

# update the .neuro/live.yaml file with the full URI of your image:
images:
  myimage:
    ref: image://neuro-compute/bob/project-specific-docker-image
```

Обратите внимание, что некоторые функции могут отсутствовать в пользовательских Docker-образах. В частности, вам может потребоваться залогиниться в AWS или GCP вручную из Вашего рабочего задания.

