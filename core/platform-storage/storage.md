# Дисковое пространство

Платформа предоставляет дисковое пространство для размещения файлов, необходимых для выполнения Ваших задач. Все пользователи имеют доступ к дисковому пространству для размещения данных, программного кода и артефактов. Каждый объем дискового пространства относится к своему кластеру и Вы не можете использовать файлы между кластерами. Управлять дисковым пространством можно из веб-интерфейса или из командной строки CLI.

На нижеприведенном рисунке показан поток данных между Вашим локальным компьютером, дисковым пространством платформы и файловой системой заданий:

![](../../.gitbook/assets/storage-2.png)

## Как я могу управлять файлами через веб-интерфейс?

Для управления файлами служит интуитивно понятный FileBrowser. FileBrowser основан на популярном интерфейсе просмотра файлов, доступном в git.

Для управления файлами:

* Войдите в веб-интерфейс платформы. 
* Нажмите **ЗАПУСТИТЬ** в виджете **Браузер дискового пространства**.

![](../../.gitbook/assets/image%20%2832%29.png)

* Выберите пресет из выпадающего списка и нажмите **ЗАПУСТИТЬ.**

![](../../.gitbook/assets/image%20%2833%29.png)

Откроется менеджер файлов для кластера, посредством которого Вы можете управлять файлами.

![&#x418;&#x43D;&#x442;&#x435;&#x440;&#x444;&#x435;&#x439;&#x441; FileBrowser](../../.gitbook/assets/image%20%2818%29.png)

Менеджер файлов имеет следующие области:

* Инструменты: Позволяет искать, загружать и выгружать файлы. Возможны также другие контекстные опции, доступные в зависимости от выбранного файла или папки. 
* Опции: В этой области можно создать новую папку или файл и управлять настройками дискового пространства. 
* Папки и файлы: Список папок и файлов, к которым у Вас есть доступ. Вы можете выбрать файл для просмотра контекстных опций на панели инструментов.

В оставшейся части руководства будет описано управление файлами с помощью CLI. Для получения дополнительной информации о FileBrowser см. документацию [FileBrowser](https://github.com/filebrowser/filebrowser).

## Как я могу управлять файлами посредством командной строки CLI?

Вы можете управлять своими файлами и папками с помощью команды `neuro storage`. CLI позволяет вам выполнять все операции с файлами и папками, доступными в FileBrowser.

### Просмотр папок и файлов

Чтобы увидеть папки и файлы в образе, выполните команду:

`neuro ls [OPTIONS] PATHS`

Для дополнительной информации см. [Список содержимого каталога](https://neu-ro.gitbook.io/neu-ro-cli-reference/commands/storage#ls).

#### **Пример команды:**

```text
$ neuro storage ls storage:nero-assistant
ModelCode  apt.txt  config  data  modules  
notebooks  requirements.txt  results  setup.cfg
```

Вы можете использовать команду `neuro storage tree` для просмотра содержимого в древовидном формате. Это может быть полезно, если у Вас имеются подпапки.

#### **Пример команды:**

```text
$ neuro storage tree storage:nero-assistant
'storage:nero-assistant'
+-- 'ModelCode'
|   +-- 'VoiceExperiment'
+-- 'apt.txt'
+-- 'config'
+-- 'data'
+-- 'modules'
+-- 'notebooks'
+-- 'requirements.txt'
+-- 'results'
+-- 'setup.cfg'

7 directories, 3 files
```

### Создание папки из CLI

Чтобы создать папку на диске из CLI, используйте команду:

`neuro storage mkdir [OPTIONS] PATHS`

Это работает так же, как и в веб-интерфейсе, но в CLI Вы можете создавать папки по любому пути, не переходя по нему.

**Пример команды:**

```text
$ neuro storage mkdir -p storage:nero-assistant/ModelCode/VoiceExperiment
```

Вы можете проверить, что папка была создана, выполнив команду `neuro storage ls` или через веб-интерфейс.

### Копирование файлов между дисковым пространством платформы и Вашей локальной файловой системой

Для копирования файлов между платформой и хостом используйте команду `neuro cp SOURCE DESTINATION`.

Чтобы содержимое папки также перемещалось при копировании, необходимо использовать команду рекурсивного копирования: `neuro cp -r SOURCE DESTINATION`.

При копировании файлов или папок есть следующие ключевые моменты:

* Команда предполагает, что указанный путь является относительным. 
* Имена файлов и папок чувствительны к регистру.

Пример:

* Для копирования файлов с локального компьютера на дисковое пространство платформы используйте следующую команду: `neuro cp parameters.txt storage:nero-assistant`. Эта команда копирует файл `parameters.txt` с локального хоста в папку `nero-assistant` на диске платформы.

```text
$ neuro cp parameters.txt storage:nero-assistant
Copy 'file:///C:/Projects/parameters.txt' => 'storage://neuro-compute/.../parameters.txt' 'parameters.txt' 952B
```

* Чтобы скопировать файлы с платформы на локальный компьютер, используйте команду: `neuro cp storage:nero-assistant/TestResults.txt file:///Projects` Данная команда копирует файл `TestResults.txt` в папке `nero-assistant`, находящейся на диске платформы, на локальный компьютер.

```text
$ neuro cp storage:nero-assistant/TestResults.txt file:///Projects 
Copy 'storage://neuro-compute/.../TestResults.txt' => 'file:///C:/Projects/TestResults.txt' 'TestResults.txt' 1.5K
```

* Чтобы скопировать папку из локальной хост-системы на дисковое пространство платформы, используйте команду: `neuro cp -r samplecode storage:nero-assistant`. Данная команда копирует папку `samplecode` и все ее содержимое в папку `nero-assistant` на дисковом пространстве платформы.

```text
$ neuro cp -r samplecode storage:nero-assistant 
Copy 'file:///C:/Projects/samplecode' => 'storage://neuro-compute/.../nero-assistant/samplecode' 'file:///C:/Projects/samplecode
```

* Чтобы скопировать папку с платформы на локальный хост используйте команду: `neuro cp -r storage:nero-assistant/testlogs file:///Projects`. Данная команда копирует папку `testlogs` на дисковом пространстве платформы, со всем ее содержимым, на локальный компьютер.

```text
$ neuro cp -r storage:nero-assistant/testlogs file:///Projects 
Copy 'storage://neuro-compute/.../nero-assistant/testlogs' => 'file:///C:/Projects/testlogs' 'storage://neuro-compute/clarytyllc/nero-assistant/testlogs' ...
```

### Удаление файлов

Для удаления файлов с дискового пространства платформы используйте команду `neuro rm [Files/Folder]`

При удалении папки, чтобы также удалить содержимое, необходимо использовать команду рекурсивного удаления: `neuro rm -r [Files/Folder]`

Примеры:

* Для удаления файла с дискового пространства платформы используйте команду `neuro rm storage:nero-assistant/parameters.txt`
* Для удаления папки с дискового пространства платформы используйте команду `neuro rm -r storage:nero-assistant/samplecode`
* Для удаления файлов с определенным шаблоном, например все файлы формата `.log`, используйте команду `neuro rm -r storage:nero-assistant/*.log`

### Перемещение файлов и папок внутри дискового пространства платформы

Перемещение файлов или папок отличается от копирования. При перемещении файлы или папки копируются в место назначения, а затем удаляются из места первоначального расположения. Чтобы переместить файлы или папки, используйте команду: `neuro storage mv`. При желании Вы также можете переименовать файл после его перемещения в каталог назначения.

Примеры:

* Чтобы переместить файл на диске платформы в другую папку на диске платформы и переименовать его, используйте команду `neuro mv storage:nero-assistant\code.txt storage:neuro-tutorial\samplecode.txt`. Эта команда перемещает файл `code.txt` из папки `nero-assistant` в папку `neuro-tutorial` и переименовывает файл в `samplecode.txt`.
* Чтобы переместить папку и ее содержимое на диске платформы на новое местоположение, используйте команду: `neuro mv -T storage:nero-assistant/ModelCode storage:neuro-tutorial/SampleCode`. Данная команда копирует папку `ModelCode` и все ее содержимое из папки `nero-assistant` в папку `neuro-tutorial` и переименовывает её в `SampleCode`.

## Как я могу использовать папки на дисковом пространстве в заданиях?

Папки на дисковом пространстве можно использовать в заданиях. Для этого надо подключить каталог на диске к контейнеру, на котором выполняется задание.

### **Замечания**:

* Задания могут выполняться медленнее при использовании папок на дисковом пространстве по сравнению с использованием файловой системы контейнера. Наши эксперементы показывают, что обучение моделей CV занимает на 10-20% больше времени, когда набор данных считывается с примонтированного каталога, расположенного на дисковом пространстве платформы. Если такая разница для Вас критична, мы рекомендуем перед выполнением задания загрузить наборы данных в не примонтированный каталог.
* Настоятельно не рекомендуется распаковывать наборы данных \(ZIP, TAR и т.д.\) в каталог на дисковом пространстве платформы, поскольку это занимает много времени.

  При работе с дисковым пространством есть несколько ключевых моментов:

* Когда Вы запускаете задание, Вы можете изменять файлы внутри его локальной файловой системы. Однако, когда Вы прекращаете работу, все изменения теряются. Чтобы избежать этого, вы должны использовать тома.
* Данные тома сохраняются даже после удаления контейнера задания. 
* Тома - это отличный способ отправить данные в контейнер, извлечь данные из контейнера и обмениваться данными между контейнерами.

### Монтирование томов

Синтаксис монтирования томов выглядит так:

```text
--volume storage:/путь/на/платформе:/путь/монтирования:[ro|rw]
```

Первая часть - `storage:/путь/на/дисковом/пространстве` - определяет путь по отношению к корневой папке дискового пространства платформы. Вы также можете указать полный URI, включающий в себя название кластера: `storage://кластер/путь/на/дисковом/пространстве`.

`:/путь/монтирования` определяет путь в контейнере задания, по которому нужно монтировать том.

Последняя часть определяет режим монтирования тома - `:ro` \(read-only\) или`:rw` \(read-write\). Если этот параметр не указан, по умолчанию используется режим read-write.

{% hint style="info" %}
Вы можете монтировать тома в тома только в случае, если целевой корневой том находится в режиме read-write.
{% endhint %}

### Пример

Чтобы использовать том при выполнении задания, Вы должны примонтировать данные к контейнеру. При желании вы можете примонтировать несколько томов к контейнеру.

Чтобы примонтировать даные к контейнеру, используйте параметр `--volume` в команде `run`. Например:

```text
$ neuro run --name job303 --volume storage:nero-assistant/ModelCode:/code:rw --preset cpu-small ubuntu cat code/train.py
```

Данная команда монтирует наборы данных из папки `ModelCode` к контейнеру для использования во время выполнения задания. Папка `/data` используются для доступа к данным из задания.

Находясь в контейнере, Вы можете обновить данные в томе. Например, для обновления файла из контейнера, Вы можете запустить из задания следующую команду:

```text
echo “New info” >/code/info.txt
```

## Как я могу делиться файлами с другими пользователями?

Вы можете открыть доступ к Вашим папкам и файлам для других пользователей, аналогично с открытием доступа к образу. Вы можете указать права доступа пользователей к файлам: read, write или manage.

Чтобы открыть доступ к файлу или папке, используйте команду `neuro share`.

**Пример команды:**

```text
$ neuro share storage:nero-assistant/ModelCode alice manage
```

Данная команда открывает доступ к `storage:nero-assistant/ModelCode` для пользователя `alice`.

Вы можете просмотреть ресурсы, которые открыты для Вас другими пользователями, используя команду `neuro acl list`:

```text
$ neuro acl list
...
storage://neuro-compute/johndoe/bone-age manage
storage://neuro-compute/neuromation/midi-generator read
storage://neuro-compute/neuromation/public read
```

## Операции с дисковым пространством на других кластерах

Все операции, описанные выше, можно выполнять с дисковым пространством на других кластерах.

Например, чтобы скопировать локальный файл `parameters.txt` на дисковое пространство кластера `<имя-кластера>`, запустите:

```text
$ neuro cp parameters.txt storage:/<имя-кластера>/<имя-пользователя>/nero-assistant
```

